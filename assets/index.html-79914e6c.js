import{_ as p,r as o,o as c,c as r,a as s,b as a,d as l,e}from"./app-24278c89.js";const t="/assets/zanshang-e2e5224e.jpg",i={},d=s("h1",{id:"agile-upgrade",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#agile-upgrade","aria-hidden":"true"},"#"),a(" Agile Upgrade")],-1),B=s("h2",{id:"_1、介绍",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#_1、介绍","aria-hidden":"true"},"#"),a(" 1、介绍")],-1),y=s("p",null,"Agile Upgrade: 用于快速构建 bootloader 的中间件。",-1),u=s("li",null,[s("p",null,[s("code",null,"example"),a(" 文件夹提供 PC 上的示例")])],-1),A={href:"https://github.com/loogg/agile_upgrade_mcu_demos",target:"_blank",rel:"noopener noreferrer"},D=e(`<h3 id="_1-1、特性" tabindex="-1"><a class="header-anchor" href="#_1-1、特性" aria-hidden="true">#</a> 1.1、特性</h3><ol><li>适配 <code>RT-Thread</code> 官方固件打包工具 (图形化工具及命令行工具)</li><li>使用纯 C 开发，不涉及任何硬件接口，可在任何形式的硬件上直接使用</li><li>加密、压缩支持如下： <ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> AES256</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> fastlz</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> quicklz</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-3" disabled="disabled"><label class="task-list-item-label" for="task-item-3"> gzip</label></li></ul></li><li>原生适配 <code>file</code> 及 <code>fal</code> 操作接口</li><li>移植简单，实现自定义的后端只需适配几个操作接口</li><li>使用简单，几行代码即可实现固件升级</li><li>全过程日志输出</li><li>提供过程回调，可将过程及进度显示在自定义硬件上</li></ol><h3 id="_1-2、目录结构" tabindex="-1"><a class="header-anchor" href="#_1-2、目录结构" aria-hidden="true">#</a> 1.2、目录结构</h3><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>adapter</td><td>已适配的后端</td></tr><tr><td>doc</td><td>文档</td></tr><tr><td>example</td><td>例子</td></tr><tr><td>figures</td><td>素材</td></tr><tr><td>inc</td><td>头文件</td></tr><tr><td>porting</td><td>移植文件</td></tr><tr><td>src</td><td>源代码</td></tr><tr><td>tools</td><td>固件打包工具</td></tr></tbody></table><h3 id="_1-3、许可证" tabindex="-1"><a class="header-anchor" href="#_1-3、许可证" aria-hidden="true">#</a> 1.3、许可证</h3><p>Agile Upgrade 遵循 <code>Apache-2.0</code> 许可，详见 <code>LICENSE</code> 文件。</p><h2 id="_2、移植" tabindex="-1"><a class="header-anchor" href="#_2、移植" aria-hidden="true">#</a> 2、移植</h2><h3 id="_2-1、配置文件" tabindex="-1"><a class="header-anchor" href="#_2-1、配置文件" aria-hidden="true">#</a> 2.1、配置文件</h3><p>Agile Upgrade 依赖 <code>agile_upgrade_config.h</code> 头文件，修改该头文件中的配置可以设置库的基本行为，禁用未使用的模块和特性，在编译时调整内存缓冲区的大小等等。</p><p><code>porting</code> 文件夹下提供了配置文件模板 <code>agile_upgrade_conf_template.h</code>，复制它并重命名为 <code>agile_upgrade_config.h</code> 并在工程中包含路径即可。</p><h4 id="基本配置" tabindex="-1"><a class="header-anchor" href="#基本配置" aria-hidden="true">#</a> 基本配置</h4><ol><li><p>使能版本号比较，开启则比较固件版本，固件版本一致不进行升级</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#define</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AGILE_UPGRADE_ENABLE_VERSION_COMPARE</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h4 id="调试功能" tabindex="-1"><a class="header-anchor" href="#调试功能" aria-hidden="true">#</a> 调试功能</h4><ol><li><p>使能日志输出</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#define</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AGILE_UPGRADE_ENABLE_LOG</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>日志输出调用的接口</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#define</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AGILE_UPGRADE_LOG_PRINTF</span><span style="color:#ABB2BF;"> printf</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h4 id="加密算法" tabindex="-1"><a class="header-anchor" href="#加密算法" aria-hidden="true">#</a> 加密算法</h4><ol><li><p>使能 AES256</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#define</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AGILE_UPGRADE_ENABLE_AES</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>AES256 初始化向量，16 个字符</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#define</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AGILE_UPGRADE_AES_IV</span><span style="color:#ABB2BF;">  </span><span style="color:#98C379;">&quot;0123456789ABCDEF&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>AES256 密钥，32 个字符</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#define</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AGILE_UPGRADE_AES_KEY</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;0123456789ABCDEF0123456789ABCDEF&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h4 id="压缩算法" tabindex="-1"><a class="header-anchor" href="#压缩算法" aria-hidden="true">#</a> 压缩算法</h4><ol><li><p>使能 fastlz</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#define</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AGILE_UPGRADE_ENABLE_FASTLZ</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>使能 quicklz</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#define</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AGILE_UPGRADE_ENABLE_QUICKLZ</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h4 id="使能后端" tabindex="-1"><a class="header-anchor" href="#使能后端" aria-hidden="true">#</a> 使能后端</h4><ol><li><p>使能 fal 后端</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#define</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AGILE_UPGRADE_ENABLE_FAL</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>使能 file 后端</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#define</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">AGILE_UPGRADE_ENABLE_FILE</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h3 id="_2-2、后端适配" tabindex="-1"><a class="header-anchor" href="#_2-2、后端适配" aria-hidden="true">#</a> 2.2、后端适配</h3><p>原生适配 <code>file</code> 及 <code>fal</code> 操作接口，自定义后端只需要实现 <code>agile_upgrade_ops</code> 接口即可。可以参考 <a href="./adapter">adapter</a> 中后端的实现。</p>`,22),_={href:"https://github.com/loogg/agile_upgrade_mcu_demos",target:"_blank",rel:"noopener noreferrer"},F=s("code",null,"MinimalistBoot",-1),v=s("code",null,"片内 Flash",-1),b=s("code",null,"SPI Flash",-1),g=e(`<div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">struct</span><span style="color:#ABB2BF;"> agile_upgrade_ops {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">init)(</span><span style="color:#56B6C2;">agile_upgrade_t</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">agu);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">read)(</span><span style="color:#56B6C2;">agile_upgrade_t</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">agu, </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> offset, </span><span style="color:#C678DD;">uint8_t</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">buf, </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> size);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">write)(</span><span style="color:#56B6C2;">agile_upgrade_t</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">agu, </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> offset, </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">uint8_t</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">buf, </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> size);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">erase)(</span><span style="color:#56B6C2;">agile_upgrade_t</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">agu, </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> offset, </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> size);</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">deinit)(</span><span style="color:#56B6C2;">agile_upgrade_t</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">agu);</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p><code>init</code></p><p>初始化后端，可以使用应用层传递的 <code>agu-&gt;user_data</code> 参数，并将生成的句柄传递给 <code>agu-&gt;ops_data</code>。不需要可不实现。</p></li><li><p><code>read</code></p><p>从后端读取数据，<code>offset</code> 为负数时表示从尾部读入。可以使用 <code>agu-&gt;ops_data</code> 参数。</p></li><li><p><code>write</code></p><p>向后端写入数据，<code>offset</code> 为负数时表示向尾部写入。可以使用 <code>agu-&gt;ops_data</code> 参数。</p></li><li><p><code>erase</code></p><p>擦除后端数据。可以使用 <code>agu-&gt;ops_data</code> 参数。不需要可不实现。</p></li><li><p><code>deinit</code></p><p>反初始化后端。可以使用 <code>agu-&gt;ops_data</code> 参数。不需要可不实现。</p></li></ol><h3 id="_2-3、rt-thread-软件包支持" tabindex="-1"><a class="header-anchor" href="#_2-3、rt-thread-软件包支持" aria-hidden="true">#</a> 2.3、RT-Thread 软件包支持</h3><p>在 <code>RT-Thread</code> 的包管理器中选中即可，不需要自行移植配置文件。</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">RT</span><span style="color:#C678DD;">-</span><span style="color:#ABB2BF;">Thread online packages</span></span>
<span class="line"><span style="color:#ABB2BF;">    system packages   </span><span style="color:#C678DD;">---&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        [</span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">] agile_upgrade: Middleware </span><span style="color:#C678DD;">for</span><span style="color:#ABB2BF;"> fast building bootloader.  </span><span style="color:#C678DD;">---&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">            [</span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">]   Enable debug log output</span></span>
<span class="line"><span style="color:#ABB2BF;">            [ ]   Enable AES decrypt</span></span>
<span class="line"><span style="color:#ABB2BF;">            [ ]   Enable fastlz decompress</span></span>
<span class="line"><span style="color:#ABB2BF;">            [</span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">]   Enable quicklz decompress</span></span>
<span class="line"><span style="color:#ABB2BF;">            [ ]   Enable fal adapter</span></span>
<span class="line"><span style="color:#ABB2BF;">            [ ]   Enable file adapter</span></span>
<span class="line"><span style="color:#ABB2BF;">            [</span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">]   Enable version compare</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3、使用-agile-upgrade" tabindex="-1"><a class="header-anchor" href="#_3、使用-agile-upgrade" aria-hidden="true">#</a> 3、使用 Agile Upgrade</h2><h3 id="_3-1、快速开始" tabindex="-1"><a class="header-anchor" href="#_3-1、快速开始" aria-hidden="true">#</a> 3.1、快速开始</h3><p>移植操作完成后，几行代码即可实现固件升级。</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">#include</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&lt;agile_upgrade.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">extern</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">struct</span><span style="color:#ABB2BF;"> agile_upgrade_ops agile_upgrade_file_ops;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">main</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">agile_upgrade_t</span><span style="color:#ABB2BF;"> src_agu </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">src_agu</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;src&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">src_agu</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">user_data</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;./src.rbl&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">src_agu</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">ops</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&amp;</span><span style="color:#ABB2BF;">agile_upgrade_file_ops;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#56B6C2;">agile_upgrade_t</span><span style="color:#ABB2BF;"> dst_agu </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> {</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">};</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">dst_agu</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;dst&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">dst_agu</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">user_data</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#98C379;">&quot;./dst.bin&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#E5C07B;">dst_agu</span><span style="color:#ABB2BF;">.</span><span style="color:#E06C75;">ops</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">&amp;</span><span style="color:#ABB2BF;">agile_upgrade_file_ops;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#61AFEF;">agile_upgrade_release</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">&amp;</span><span style="color:#ABB2BF;">src_agu, </span><span style="color:#C678DD;">&amp;</span><span style="color:#ABB2BF;">dst_agu, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    </span><span style="color:#C678DD;">return</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>agile_upgrade</code></p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">struct</span><span style="color:#ABB2BF;"> agile_upgrade {</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">char</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">name;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> len;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">user_data;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">struct</span><span style="color:#ABB2BF;"> agile_upgrade_ops </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">ops;</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span><span style="color:#C678DD;">const</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">*</span><span style="color:#ABB2BF;">ops_data;</span></span>
<span class="line"><span style="color:#ABB2BF;">};</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>name</code></p><p>后端名称，日志打印中会使用。如果为 <code>NULL</code>，日志中会输出为 <code>UNKNOWN</code>。</p></li><li><p><code>len</code></p><p>后端能操作空间大小(Byte)，校验固件和搬运时进行判断。如果为 0 则不进行判断。</p></li><li><p><code>user_data</code></p><p>后端私有数据，一般用于 <code>agu-&gt;ops-&gt;init</code> 中作为初始化的参数。</p></li><li><p><code>ops</code></p><p>后端操作接口。</p></li><li><p><code>ops_data</code></p><p>后端操作接口私有数据。</p></li></ul></li></ul><h3 id="_3-2、api-介绍" tabindex="-1"><a class="header-anchor" href="#_3-2、api-介绍" aria-hidden="true">#</a> 3.2、API 介绍</h3><ol><li><p>固件校验</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">agile_upgrade_verify</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">agile_upgrade_t</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">*</span><span style="color:#E06C75;font-style:italic;">agu</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">agile_upgrade_fw_info_t</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">*</span><span style="color:#E06C75;font-style:italic;">fw_info</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">uint8_t</span><span style="color:#E06C75;"> </span><span style="color:#E06C75;font-style:italic;">is_tail</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>agu</td><td>操作对象</td></tr><tr><td>fw_info</td><td>固件信息</td></tr><tr><td>is_tail</td><td>0：固件信息在头部<br>1：固件信息在尾部</td></tr></tbody></table></li><li><p>固件升级</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">agile_upgrade_release</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">agile_upgrade_t</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">*</span><span style="color:#E06C75;font-style:italic;">src_agu</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#56B6C2;">agile_upgrade_t</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">*</span><span style="color:#E06C75;font-style:italic;">dst_agu</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> </span><span style="color:#C678DD;">uint8_t</span><span style="color:#E06C75;"> </span><span style="color:#E06C75;font-style:italic;">is_erase</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>src_agu</td><td>源操作对象</td></tr><tr><td>dst_agu</td><td>目标操作对象</td></tr><tr><td>is_erase</td><td>升级完成后是否需要擦除源操作对象</td></tr></tbody></table></li><li><p>设置钩子函数</p><p>固件解析按步骤执行，每一步执行前会调用步骤钩子函数；异常时会调用异常钩子函数；每解析一包数据会调用进度钩子函数。</p><ul><li><p>步骤枚举</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">typedef</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">enum</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_STEP_INIT </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_STEP_VERIFY,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_STEP_ALGO,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_STEP_UPGRADE,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_STEP_FINISH</span></span>
<span class="line"><span style="color:#ABB2BF;">} </span><span style="color:#56B6C2;">agile_upgrade_step_t</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>错误码枚举</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">typedef</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">enum</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_EOK </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_ERR </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">-</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_EVERIFY </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">-</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_EFULL </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">-</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_EREAD </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">-</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_EWRITE </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">-</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_EERASE </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">-</span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;">AGILE_UPGRADE_EINVAL </span><span style="color:#C678DD;">=</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">-</span><span style="color:#D19A66;">7</span></span>
<span class="line"><span style="color:#ABB2BF;">} </span><span style="color:#56B6C2;">agile_upgrade_err_t</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>设置步骤钩子函数</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">agile_upgrade_set_step_hook</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">agile_upgrade_step_callback_t</span><span style="color:#E06C75;"> </span><span style="color:#E06C75;font-style:italic;">hook</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">typedef</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">*</span><span style="color:#56B6C2;">agile_upgrade_step_callback_t</span><span style="color:#ABB2BF;">)(</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> step);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>设置进度钩子函数</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">agile_upgrade_set_progress_hook</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">agile_upgrade_progress_callback_t</span><span style="color:#E06C75;"> </span><span style="color:#E06C75;font-style:italic;">hook</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">typedef</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">*</span><span style="color:#56B6C2;">agile_upgrade_progress_callback_t</span><span style="color:#ABB2BF;">)(</span><span style="color:#C678DD;">uint32_t</span><span style="color:#ABB2BF;"> cur_size, </span><span style="color:#C678DD;">uint32_t</span><span style="color:#ABB2BF;"> total_size);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>设置错误钩子函数</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="shiki one-dark-pro" style="background-color:#282c34;" tabindex="0"><code><span class="line"><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> </span><span style="color:#61AFEF;">agile_upgrade_set_error_hook</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">agile_upgrade_error_callback_t</span><span style="color:#E06C75;"> </span><span style="color:#E06C75;font-style:italic;">hook</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">typedef</span><span style="color:#ABB2BF;"> </span><span style="color:#C678DD;">void</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">*</span><span style="color:#56B6C2;">agile_upgrade_error_callback_t</span><span style="color:#ABB2BF;">)(</span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> step, </span><span style="color:#C678DD;">int</span><span style="color:#ABB2BF;"> code);</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ol><h2 id="_4、支持" tabindex="-1"><a class="header-anchor" href="#_4、支持" aria-hidden="true">#</a> 4、支持</h2><figure><img src="`+t+'" alt="zanshang" tabindex="0" loading="lazy"><figcaption>zanshang</figcaption></figure><p>如果 Agile Upgrade 解决了你的问题，不妨扫描上面二维码请我 <strong>喝杯咖啡</strong> ~</p><h2 id="_5、联系方式-感谢" tabindex="-1"><a class="header-anchor" href="#_5、联系方式-感谢" aria-hidden="true">#</a> 5、联系方式 &amp; 感谢</h2>',16),h=s("li",null,"维护：马龙伟",-1),m={href:"https://github.com/loogg/agile_upgrade",target:"_blank",rel:"noopener noreferrer"},C=s("li",null,[a("邮箱："),s("a",{href:"mailto:2544047213@qq.com"},"2544047213@qq.com")],-1);function E(k,f){const n=o("ExternalLinkIcon");return c(),r("div",null,[d,B,y,s("ul",null,[u,s("li",null,[s("p",null,[a("MCU 上的示例查看 "),s("a",A,[a("MCU Demos"),l(n)])])])]),D,s("p",null,[s("a",_,[a("MCU Demos"),l(n)]),a(" 的 "),F,a(" 示例提供了直接操作 "),v,a(" 和 "),b,a(" 后端实现，可作为参考。")]),g,s("ul",null,[h,s("li",null,[a("主页："),s("a",m,[a("https://github.com/loogg/agile_upgrade"),l(n)])]),C])])}const G=p(i,[["render",E],["__file","index.html.vue"]]);export{G as default};
